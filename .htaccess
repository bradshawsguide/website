<IfModule mod_rewrite.c>
  RewriteEngine on

  # Serve files from www subfolder
  RewriteCond %{HTTPS_HOST} ^beta.bradshaws.guide$ [NC,OR]
  RewriteCond %{REQUEST_URI} !www
  RewriteRule (.*) /www/$1 [L]

  # Block files and folders beginning with a dot, such as .git
  # Except for the .well-known folder, which is used for Let's Encrypt and security.txt
  # RewriteRule (^|/)\.(?!well-known\/) index.php [L]

  # Block direct access to Kirby and the cache sources
  RewriteRule ^www/kirby(.*) index.php
  RewriteRule ^www/cache(.*) index.php

  # Make site links work
  RewriteCond %{REQUEST_FILENAME} !-f
  RewriteCond %{REQUEST_FILENAME} !-d
  RewriteRule ^(.*) index.php [L]
</IfModule>

# Pass the Authorization header to PHP
SetEnvIf Authorization "(.*)" HTTP_AUTHORIZATION=$1

# Compress text file responses
<IfModule mod_deflate.c>
  AddOutputFilterByType DEFLATE text/plain
  AddOutputFilterByType DEFLATE text/html
  AddOutputFilterByType DEFLATE text/css
  AddOutputFilterByType DEFLATE text/javascript
  AddOutputFilterByType DEFLATE application/json
  AddOutputFilterByType DEFLATE application/javascript
  AddOutputFilterByType DEFLATE application/x-javascript
</IfModule>
